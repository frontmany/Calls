import sys
sys.path.append('C:/prj/Callifornia/build/clientUpdaterPy/Debug')
import clientUpdaterPy

class UpdateManager:
    def __init__(self):
        self.client = clientUpdaterPy.ClientUpdater(
            self.on_check_result,    # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ checkUpdates()
            self.on_update_loaded,   # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ó–ê–ì–†–£–ñ–ï–ù–û
            self.on_error           # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
        )
        self.current_version = "1.0.0"
    
    def on_check_result(self, result):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"""
        print(f"–ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: {result}")
        
        if result == clientUpdaterPy.CheckResult.UPDATE_NOT_NEEDED:
            print("‚úÖ –í–∞—à–∞ –≤–µ—Ä—Å–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞!")
            
        elif result == clientUpdaterPy.CheckResult.REQUIRED_UPDATE:
            print("üî¥ –¢—Ä–µ–±—É–µ—Ç—Å—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!")
            print("–ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...")
            self.start_update()
            
        elif result == clientUpdaterPy.CheckResult.POSSIBLE_UPDATE:
            print("üü° –î–æ—Å—Ç—É–ø–Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ")
            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if self.ask_user_for_update():
                self.start_update()
            else:
                self.decline_update()
    
    def on_update_loaded(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ó–ê–ì–†–£–ñ–ï–ù–û –Ω–∞ –∫–ª–∏–µ–Ω—Ç"""
        print("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!")
        print("–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ")
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
        self.install_update()
    
    def on_error(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –õ–Æ–ë–û–ô –æ—à–∏–±–∫–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
        print("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!")
        print("–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
        print("- –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º")
        print("- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤")
        print("- –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        self.show_error_message()
    
    def ask_user_for_update(self):
        """–°–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç GUI –¥–∏–∞–ª–æ–≥
        response = input("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ? (y/n): ")
        return response.lower() == 'y'
    
    def start_update(self):
        """–ù–∞—á–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
        print("üì• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...")
        os_type = clientUpdaterPy.OperationSystemType.WINDOWS
        self.client.startUpdate(os_type)
        # –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω on_update_loaded –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
        # –∏–ª–∏ on_error –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
    
    def decline_update(self):
        """–û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"""
        self.client.declineUpdate()
        print("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ")
    
    def install_update(self):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"""
        print("üîÑ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...")
        # –ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        # –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞, —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ —Ç.–¥.
    
    def show_error_message(self):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"""
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç GUI —Å–æ–æ–±—â–µ–Ω–∏–µ
        print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞")

# –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ workflow
def main():
    manager = UpdateManager()
    
    try:
        # 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
        manager.client.connect("192.168.1.44", "8081")
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        print("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...")
        #manager.client.checkUpdates(manager.current_version)
        # ‚Üí –ë—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω on_check_result —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        
        # –ñ–¥–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
        input("–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
    finally:
        manager.client.disconnect()

if __name__ == "__main__":
    main()